<!doctype html>
<html>
  <head>
    <title>PDF Export Fix Test</title>
  </head>
  <body>
    <h1>PDF Export Fix Test</h1>
    <div id="results"></div>

    <script>
      // Simulate the fixed formatDateForPDF function
      function formatDateForPDF(dateStr, timeStr) {
        // Handle missing or invalid date/time data
        if (!dateStr || !timeStr) {
          return 'N/A'
        }

        try {
          // Handle different date formats and validate input
          let dateParts, timeParts

          // Handle YYYY-MM-DD format
          if (dateStr.includes('-')) {
            dateParts = dateStr.split('-').map(Number)
          } else if (dateStr.includes('/')) {
            dateParts = dateStr.split('/').map(Number)
          } else {
            // Try to parse as ISO date
            const parsedDate = new Date(dateStr)
            if (isNaN(parsedDate.getTime())) {
              return 'Invalid Date'
            }
            return parsedDate.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
            })
          }

          // Handle HH:MM format
          if (timeStr.includes(':')) {
            timeParts = timeStr.split(':').map(Number)
          } else {
            timeParts = [0, 0] // Default to midnight if time is invalid
          }

          // Validate date parts
          if (dateParts.length < 3 || dateParts.some(isNaN)) {
            return 'Invalid Date'
          }

          const [year, month, day] = dateParts
          const [hours, minutes] = timeParts.length >= 2 ? timeParts : [0, 0]

          // Create date object
          const date = new Date(year, (month || 1) - 1, day || 1, hours || 0, minutes || 0)

          // Check if date is valid
          if (isNaN(date.getTime())) {
            return 'Invalid Date'
          }

          const months = [
            'Jan',
            'Feb',
            'Mar',
            'Apr',
            'May',
            'Jun',
            'Jul',
            'Aug',
            'Sep',
            'Oct',
            'Nov',
            'Dec',
          ]

          const monthName = months[date.getMonth()] || 'Jan'
          const dayNum = date.getDate() || 1
          const yearNum = date.getFullYear()

          let hours12 = date.getHours()
          const minutesStr = date.getMinutes().toString().padStart(2, '0')
          const ampm = hours12 >= 12 ? 'PM' : 'AM'

          hours12 = hours12 % 12
          hours12 = hours12 ? hours12 : 12

          return `${monthName} ${dayNum}, ${yearNum} ${hours12}:${minutesStr} ${ampm}`
        } catch (error) {
          console.warn('Error formatting date for PDF:', { dateStr, timeStr, error })
          return 'Invalid Date'
        }
      }

      // Test cases
      const testCases = [
        // Normal cases
        { date: '2025-12-16', time: '13:30', expected: 'should work' },
        { date: '2025/12/16', time: '09:15', expected: 'should work' },

        // Problem cases that caused the error
        { date: null, time: '13:30', expected: 'N/A' },
        { date: '2025-12-16', time: null, expected: 'N/A' },
        { date: undefined, time: '13:30', expected: 'N/A' },
        { date: '', time: '13:30', expected: 'N/A' },
        { date: '2025-12-16', time: '', expected: 'N/A' },

        // Invalid date formats
        { date: 'invalid', time: '13:30', expected: 'Invalid Date' },
        { date: '2025-13-40', time: '13:30', expected: 'Invalid Date' },
        { date: 'not-a-date', time: '25:70', expected: 'Invalid Date' },
      ]

      const resultsDiv = document.getElementById('results')
      let html = '<h2>Test Results:</h2>'

      testCases.forEach((testCase, index) => {
        try {
          const result = formatDateForPDF(testCase.date, testCase.time)
          const status = result !== 'Error' ? '✅ PASS' : '❌ FAIL'
          html += `<div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc;">
                    <strong>Test ${index + 1}:</strong> ${status}<br>
                    <strong>Input:</strong> date="${testCase.date}", time="${testCase.time}"<br>
                    <strong>Result:</strong> ${result}<br>
                    <strong>Expected:</strong> ${testCase.expected}
                </div>`
        } catch (error) {
          html += `<div style="margin: 10px 0; padding: 10px; border: 1px solid red;">
                    <strong>Test ${index + 1}:</strong> ❌ FAIL (Exception)<br>
                    <strong>Input:</strong> date="${testCase.date}", time="${testCase.time}"<br>
                    <strong>Error:</strong> ${error.message}
                </div>`
        }
      })

      resultsDiv.innerHTML = html
    </script>
  </body>
</html>
